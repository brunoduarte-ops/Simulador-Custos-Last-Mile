<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interativo de Custos Last Mile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate & Amber -->
    <!-- Application Structure Plan: A dashboard-style layout was chosen to provide an intuitive and interactive experience. The screen is split into two main columns. The left column contains all user-adjustable inputs (e.g., number of couriers, costs), using sliders for immediate tactile feedback. The right column displays the results in real-time through KPI cards and a dynamic line chart. This cause-and-effect structure allows users to instantly see how changing a variable impacts profitability and the break-even point, which is the core goal of the simulator. The flow is simple: adjust inputs on the left, and observe outputs on the right. -->
    <!-- Visualization & Content Choices: Inputs are represented by sliders and number fields for interactivity. Key outputs (profit, revenue, costs) are shown in large, clear KPI cards for quick assessment. The central visualization is a Chart.js line chart plotting revenue, costs, and profit against order volume. This directly addresses the user's need to visualize profitability and the break-even point (where cost and revenue lines intersect). The choice of a line chart is ideal for showing trends and relationships over a continuous variable like volume. All interactions trigger a recalculation and UI update, providing a seamless simulation experience. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #475569;
        }
        .slider-value {
            font-weight: 600;
            color: #1e293b;
            background-color: #f1f5f9;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            min-width: 60px;
            text-align: center;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ca8a04;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ca8a04;
            cursor: pointer;
            border-radius: 50%;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Simulador Interativo de Custos Last Mile</h1>
            <p class="mt-2 text-lg text-slate-600">Ajuste os parâmetros para encontrar o ponto de equilíbrio e otimizar sua operação.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <aside class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-1 text-slate-900">Parâmetros da Operação</h2>
                <p class="text-sm text-slate-500 mb-6">Utilize os controles deslizantes para testar diferentes cenários operacionais e financeiros. As mudanças serão refletidas instantaneamente nos resultados ao lado.</p>

                <div id="input-form" class="space-y-6">
                    
                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Estrutura e Volume</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="diasUteis" class="slider-label"><span>Dias úteis / mês</span><span class="slider-value" id="diasUteisValue">22</span></label>
                                <input type="range" id="diasUteis" min="1" max="31" value="22" class="w-full">
                            </div>
                            <div>
                                <label for="pedidosPorEntregador" class="slider-label"><span>Pedidos por entregador / dia</span><span class="slider-value" id="pedidosPorEntregadorValue">18</span></label>
                                <input type="range" id="pedidosPorEntregador" min="1" max="100" value="18" class="w-full">
                            </div>
                             <div>
                                <label for="volumetriaTotal" class="slider-label"><span>Volumetria total de pedidos / mês</span><span class="slider-value" id="volumetriaTotalValue">1000</span></label>
                                <input type="range" id="volumetriaTotal" min="100" max="20000" value="1000" step="100" class="w-full">
                            </div>
                             <div>
                                <label for="kmPorEntrega" class="slider-label"><span>Média de km / entrega</span><span class="slider-value" id="kmPorEntregaValue">5</span></label>
                                <input type="range" id="kmPorEntrega" min="1" max="50" value="5" class="w-full">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Custos e Pagamento</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="font-medium text-sm text-slate-600">Modelo de Pagamento ao Entregador</label>
                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                    <label><input type="radio" name="paymentModel" value="km" class="mr-1"> R$/km</label>
                                    <label><input type="radio" name="paymentModel" value="pedido" checked class="mr-1"> R$/pedido</label>
                                    <label><input type="radio" name="paymentModel" value="diaria" class="mr-1"> R$/diária</label>
                                </div>
                            </div>
                             <div>
                                <label for="valorKm" class="slider-label"><span>Valor por km rodado (R$)</span><span class="slider-value" id="valorKmValue">2.50</span></label>
                                <input type="range" id="valorKm" min="0.1" max="10" value="2.5" step="0.1" class="w-full">
                            </div>
                            <div>
                                <label for="valorPedido" class="slider-label"><span>Valor por pedido (R$)</span><span class="slider-value" id="valorPedidoValue">15.00</span></label>
                                <input type="range" id="valorPedido" min="1" max="50" value="15" step="0.5" class="w-full">
                            </div>
                            <div>
                                <label for="valorDiaria" class="slider-label"><span>Valor da diária (R$)</span><span class="slider-value" id="valorDiariaValue">150</span></label>
                                <input type="range" id="valorDiaria" min="50" max="300" value="150" class="w-full">
                            </div>
                            <div>
                                <label for="custoFixo" class="slider-label"><span>Custos fixos mensais (R$)</span><span class="slider-value" id="custoFixoValue">25000</span></label>
                                <input type="range" id="custoFixo" min="0" max="100000" value="25000" step="500" class="w-full">
                            </div>
                            <div>
                                <label for="custoVariavelPedido" class="slider-label"><span>Custo variável / pedido (R$)</span><span class="slider-value" id="custoVariavelPedidoValue">1.25</span></label>
                                <input type="range" id="custoVariavelPedido" min="0" max="10" value="1.25" step="0.05" class="w-full">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Receita</h3>
                         <div class="space-y-4">
                            <div>
                                <label for="receitaMediaPedido" class="slider-label"><span>Receita média / pedido (R$)</span><span class="slider-value" id="receitaMediaPedidoValue">25.00</span></label>
                                <input type="range" id="receitaMediaPedido" min="5" max="100" value="25" step="0.5" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="lg:col-span-2 space-y-8">
                 <div>
                    <h2 class="text-xl font-bold mb-1 text-slate-900">Resultados e Projeções</h2>
                    <p class="text-sm text-slate-500 mb-4">Estes são os principais indicadores financeiros da sua operação, calculados com base nos parâmetros definidos. Eles são atualizados automaticamente a cada ajuste que você faz.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Receita Total Mensal</h4>
                            <p id="receitaTotal" class="text-2xl md:text-3xl font-bold text-amber-600 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Custo Total Mensal</h4>
                            <p id="custoTotal" class="text-2xl md:text-3xl font-bold text-red-600 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Lucro / Prejuízo</h4>
                            <p id="lucroPrejuizo" class="text-2xl md:text-3xl font-bold mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Pedidos / Mês</h4>
                            <p id="volumetriaTotalOutput" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">0</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Nº de Entregadores</h4>
                            <p id="entregadores" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">0</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Custo por Pedido</h4>
                            <p id="custoPorPedido" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Break-Even (Pedidos)</h4>
                            <p id="breakEven" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">0</p>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                     <h3 class="text-lg font-semibold text-slate-800 mb-1">Análise de Ponto de Equilíbrio e Lucratividade</h3>
                     <p class="text-sm text-slate-500 mb-4">O gráfico abaixo ilustra a relação entre receitas, custos e o volume de pedidos. O ponto onde a linha de receita cruza a de custos é o seu ponto de equilíbrio (break-even), a partir do qual a operação começa a gerar lucro.</p>
                    <div class="chart-container">
                        <canvas id="profitabilityChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = {
                diasUteis: document.getElementById('diasUteis'),
                pedidosPorEntregador: document.getElementById('pedidosPorEntregador'),
                volumetriaTotal: document.getElementById('volumetriaTotal'),
                kmPorEntrega: document.getElementById('kmPorEntrega'),
                valorKm: document.getElementById('valorKm'),
                valorPedido: document.getElementById('valorPedido'),
                valorDiaria: document.getElementById('valorDiaria'),
                custoFixo: document.getElementById('custoFixo'),
                custoVariavelPedido: document.getElementById('custoVariavelPedido'),
                receitaMediaPedido: document.getElementById('receitaMediaPedido'),
            };

            const valueSpans = {
                diasUteisValue: document.getElementById('diasUteisValue'),
                pedidosPorEntregadorValue: document.getElementById('pedidosPorEntregadorValue'),
                volumetriaTotalValue: document.getElementById('volumetriaTotalValue'),
                kmPorEntregaValue: document.getElementById('kmPorEntregaValue'),
                valorKmValue: document.getElementById('valorKmValue'),
                valorPedidoValue: document.getElementById('valorPedidoValue'),
                valorDiariaValue: document.getElementById('valorDiariaValue'),
                custoFixoValue: document.getElementById('custoFixoValue'),
                custoVariavelPedidoValue: document.getElementById('custoVariavelPedidoValue'),
                receitaMediaPedidoValue: document.getElementById('receitaMediaPedidoValue'),
            };

            const outputs = {
                receitaTotal: document.getElementById('receitaTotal'),
                custoTotal: document.getElementById('custoTotal'),
                lucroPrejuizo: document.getElementById('lucroPrejuizo'),
                volumetriaTotal: document.getElementById('volumetriaTotalOutput'),
                entregadores: document.getElementById('entregadores'),
                custoPorPedido: document.getElementById('custoPorPedido'),
                breakEven: document.getElementById('breakEven'),
            };

            const formatCurrency = (value) => {
                if (isNaN(value) || !isFinite(value)) return 'R$ 0,00';
                return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            };

            const formatNumber = (value) => {
                 if (isNaN(value) || !isFinite(value)) return 'N/A';
                 return Math.ceil(value).toLocaleString('pt-BR');
            }

            const ctx = document.getElementById('profitabilityChart').getContext('2d');
            const profitabilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Receita Total',
                            data: [],
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                        },
                        {
                            label: 'Custo Total',
                            data: [],
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                        },
                        {
                            label: 'Lucro/Prejuízo',
                            data: [],
                            borderColor: '#ca8a04',
                            backgroundColor: 'rgba(202, 138, 4, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value, index, values) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                           ticks: {
                                maxRotation: 0,
                                minRotation: 0
                           }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            function calculateAndRender() {
                const vals = {};
                for (const key in inputs) {
                    if (key === 'paymentModel') {
                         vals[key] = document.querySelector('input[name="paymentModel"]:checked').value;
                    } else {
                        vals[key] = parseFloat(inputs[key].value);
                    }
                }

                const volumetriaTotal = vals.volumetriaTotal;
                const entregadores = volumetriaTotal / (vals.pedidosPorEntregador * vals.diasUteis);
                const receitaTotal = volumetriaTotal * vals.receitaMediaPedido;
                
                let custoMotoboy = 0;
                if (vals.paymentModel === 'km') {
                    custoMotoboy = volumetriaTotal * vals.kmPorEntrega * vals.valorKm;
                } else if (vals.paymentModel === 'pedido') {
                    custoMotoboy = volumetriaTotal * vals.valorPedido;
                } else if (vals.paymentModel === 'diaria') {
                    custoMotoboy = entregadores * vals.diasUteis * vals.valorDiaria;
                }

                const custoVariavelTotal = volumetriaTotal * vals.custoVariavelPedido;
                const custoTotal = vals.custoFixo + custoVariavelTotal + custoMotoboy;
                const lucroPrejuizo = receitaTotal - custoTotal;
                const custoPorPedido = volumetriaTotal > 0 ? custoTotal / volumetriaTotal : 0;
                
                const receitaPorPedido = vals.receitaMediaPedido;
                let custoVariavelUnitarioTotal = vals.custoVariavelPedido;
                if (vals.paymentModel === 'km') {
                     custoVariavelUnitarioTotal += vals.kmPorEntrega * vals.valorKm;
                } else if (vals.paymentModel === 'pedido') {
                    custoVariavelUnitarioTotal += vals.valorPedido;
                } 
                
                const margemContribuicao = receitaPorPedido - custoVariavelUnitarioTotal;
                let breakEven = 0;
                if (margemContribuicao > 0) {
                     breakEven = vals.custoFixo / margemContribuicao;
                } else if (vals.paymentModel === 'diaria') {
                     const receitaDiariaEntregador = vals.pedidosPorEntregador * vals.receitaMediaPedido;
                     const custoVarDiarioEntregador = vals.pedidosPorEntregador * vals.custoVariavelPedido + vals.valorDiaria;
                     const margemDiariaEntregador = receitaDiariaEntregador - custoVarDiarioEntregador;
                     if(margemDiariaEntregador > 0) {
                        const entregadoresNecessarios = vals.custoFixo / (margemDiariaEntregador * vals.diasUteis);
                        breakEven = entregadoresNecessarios * vals.pedidosPorEntregador * vals.diasUteis;
                     } else {
                        breakEven = Infinity;
                     }
                } else {
                    breakEven = Infinity;
                }
               
                outputs.receitaTotal.textContent = formatCurrency(receitaTotal);
                outputs.custoTotal.textContent = formatCurrency(custoTotal);
                outputs.lucroPrejuizo.textContent = formatCurrency(lucroPrejuizo);
                outputs.lucroPrejuizo.classList.toggle('text-green-600', lucroPrejuizo >= 0);
                outputs.lucroPrejuizo.classList.toggle('text-red-600', lucroPrejuizo < 0);
                outputs.volumetriaTotal.textContent = formatNumber(volumetriaTotal);
                outputs.entregadores.textContent = formatNumber(entregadores);
                outputs.custoPorPedido.textContent = formatCurrency(custoPorPedido);
                outputs.breakEven.textContent = formatNumber(breakEven);

                updateChart(volumetriaTotal, receitaPorPedido, vals.custoFixo, vals);
            }
            
            function updateChart(currentVolume, receitaUnitaria, custoFixo, currentVals) {
                const labels = [];
                const receitaData = [];
                const custoData = [];
                const lucroData = [];

                const maxVolume = Math.max(currentVolume * 2, 1000);
                const step = Math.ceil(maxVolume / 20);

                for (let vol = 0; vol <= maxVolume; vol += step) {
                    labels.push(vol);
                    const receita = vol * receitaUnitaria;
                    let custo = custoFixo;
                    let custoMotoboy = 0;
                    
                    if (currentVals.paymentModel === 'km') {
                        custoMotoboy = vol * currentVals.kmPorEntrega * currentVals.valorKm;
                    } else if (currentVals.paymentModel === 'pedido') {
                        custoMotoboy = vol * currentVals.valorPedido;
                    } else if (currentVals.paymentModel === 'diaria') {
                        if (currentVals.pedidosPorEntregador > 0) {
                            const entregadoresNecessarios = Math.ceil(vol / (currentVals.pedidosPorEntregador * currentVals.diasUteis));
                            custoMotoboy = entregadoresNecessarios * currentVals.diasUteis * currentVals.valorDiaria;
                        }
                    }

                    const custoVariavelTotal = vol * currentVals.custoVariavelPedido;
                    custo += custoVariavelTotal + custoMotoboy;

                    receitaData.push(receita);
                    custoData.push(custo);
                    lucroData.push(receita - custo);
                }

                profitabilityChart.data.labels = labels;
                profitabilityChart.data.datasets[0].data = receitaData;
                profitabilityChart.data.datasets[1].data = custoData;
                profitabilityChart.data.datasets[2].data = lucroData;
                profitabilityChart.update();
            }


            const allInputs = document.querySelectorAll('#input-form input');
            allInputs.forEach(input => {
                input.addEventListener('input', () => {
                     if (input.type === 'range') {
                        const valueSpan = document.getElementById(input.id + 'Value');
                        if (valueSpan) {
                            if (input.step < 1) {
                                valueSpan.textContent = parseFloat(input.value).toFixed(2);
                            } else {
                                valueSpan.textContent = input.value;
                            }
                        }
                    }
                    calculateAndRender();
                });
            });

            calculateAndRender();
        });
    </script>
</body>
</html>

            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #475569;
        }
        .slider-value {
            font-weight: 600;
            color: #1e293b;
            background-color: #f1f5f9;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            min-width: 60px;
            text-align: center;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ca8a04;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ca8a04;
            cursor: pointer;
            border-radius: 50%;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Simulador Interativo de Custos Last Mile</h1>
            <p class="mt-2 text-lg text-slate-600">Ajuste os parâmetros para encontrar o ponto de equilíbrio e otimizar sua operação.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <aside class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-1 text-slate-900">Parâmetros da Operação</h2>
                <p class="text-sm text-slate-500 mb-6">Utilize os controles deslizantes para testar diferentes cenários operacionais e financeiros. As mudanças serão refletidas instantaneamente nos resultados ao lado.</p>

                <div id="input-form" class="space-y-6">
                    
                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Estrutura e Volume</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="diasUteis" class="slider-label"><span>Dias úteis / mês</span><span class="slider-value" id="diasUteisValue">22</span></label>
                                <input type="range" id="diasUteis" min="1" max="31" value="22" class="w-full">
                            </div>
                            <div>
                                <label for="entregadores" class="slider-label"><span>Nº de entregadores</span><span class="slider-value" id="entregadoresValue">15</span></label>
                                <input type="range" id="entregadores" min="1" max="100" value="15" class="w-full">
                            </div>
                            <div>
                                <label for="pedidosPorEntregador" class="slider-label"><span>Pedidos / entregador / dia</span><span class="slider-value" id="pedidosPorEntregadorValue">18</span></label>
                                <input type="range" id="pedidosPorEntregador" min="1" max="100" value="18" class="w-full">
                            </div>
                             <div>
                                <label for="kmPorEntrega" class="slider-label"><span>Média de km / entrega</span><span class="slider-value" id="kmPorEntregaValue">5</span></label>
                                <input type="range" id="kmPorEntrega" min="1" max="50" value="5" class="w-full">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Custos e Pagamento</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="font-medium text-sm text-slate-600">Modelo de Pagamento ao Entregador</label>
                                <div class="flex items-center space-x-4 mt-2 text-sm">
                                    <label><input type="radio" name="paymentModel" value="km" class="mr-1"> R$/km</label>
                                    <label><input type="radio" name="paymentModel" value="pedido" checked class="mr-1"> R$/pedido</label>
                                    <label><input type="radio" name="paymentModel" value="diaria" class="mr-1"> R$/diária</label>
                                </div>
                            </div>
                             <div>
                                <label for="valorKm" class="slider-label"><span>Valor por km (R$)</span><span class="slider-value" id="valorKmValue">2.50</span></label>
                                <input type="range" id="valorKm" min="0.1" max="10" value="2.5" step="0.1" class="w-full">
                            </div>
                            <div>
                                <label for="valorPedido" class="slider-label"><span>Valor por pedido (R$)</span><span class="slider-value" id="valorPedidoValue">15.00</span></label>
                                <input type="range" id="valorPedido" min="1" max="50" value="15" step="0.5" class="w-full">
                            </div>
                            <div>
                                <label for="valorDiaria" class="slider-label"><span>Valor da diária (R$)</span><span class="slider-value" id="valorDiariaValue">150</span></label>
                                <input type="range" id="valorDiaria" min="50" max="300" value="150" class="w-full">
                            </div>
                            <div>
                                <label for="custoFixo" class="slider-label"><span>Custos fixos mensais (R$)</span><span class="slider-value" id="custoFixoValue">25000</span></label>
                                <input type="range" id="custoFixo" min="0" max="100000" value="25000" step="500" class="w-full">
                            </div>
                            <div>
                                <label for="custoVariavelPedido" class="slider-label"><span>Custo variável / pedido (R$)</span><span class="slider-value" id="custoVariavelPedidoValue">1.25</span></label>
                                <input type="range" id="custoVariavelPedido" min="0" max="10" value="1.25" step="0.05" class="w-full">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-semibold text-slate-700 border-b pb-2 mb-3">Receita</h3>
                         <div class="space-y-4">
                            <div>
                                <label for="receitaMediaPedido" class="slider-label"><span>Receita média / pedido (R$)</span><span class="slider-value" id="receitaMediaPedidoValue">25.00</span></label>
                                <input type="range" id="receitaMediaPedido" min="5" max="100" value="25" step="0.5" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="lg:col-span-2 space-y-8">
                 <div>
                    <h2 class="text-xl font-bold mb-1 text-slate-900">Resultados e Projeções</h2>
                    <p class="text-sm text-slate-500 mb-4">Estes são os principais indicadores financeiros da sua operação, calculados com base nos parâmetros definidos. Eles são atualizados automaticamente a cada ajuste que você faz.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Receita Total Mensal</h4>
                            <p id="receitaTotal" class="text-2xl md:text-3xl font-bold text-amber-600 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Custo Total Mensal</h4>
                            <p id="custoTotal" class="text-2xl md:text-3xl font-bold text-red-600 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Lucro / Prejuízo</h4>
                            <p id="lucroPrejuizo" class="text-2xl md:text-3xl font-bold mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Pedidos / Mês</h4>
                            <p id="volumetriaTotal" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">0</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Custo por Pedido</h4>
                            <p id="custoPorPedido" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">R$ 0,00</p>
                        </div>
                        <div class="kpi-card text-center">
                            <h4 class="text-sm font-medium text-slate-500">Break-Even (Pedidos)</h4>
                            <p id="breakEven" class="text-2xl md:text-3xl font-bold text-slate-700 mt-1">0</p>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                     <h3 class="text-lg font-semibold text-slate-800 mb-1">Análise de Ponto de Equilíbrio e Lucratividade</h3>
                     <p class="text-sm text-slate-500 mb-4">O gráfico abaixo ilustra a relação entre receitas, custos e o volume de pedidos. O ponto onde a linha de receita cruza a de custos é o seu ponto de equilíbrio (break-even), a partir do qual a operação começa a gerar lucro.</p>
                    <div class="chart-container">
                        <canvas id="profitabilityChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = {
                diasUteis: document.getElementById('diasUteis'),
                entregadores: document.getElementById('entregadores'),
                pedidosPorEntregador: document.getElementById('pedidosPorEntregador'),
                kmPorEntrega: document.getElementById('kmPorEntrega'),
                paymentModel: document.querySelector('input[name="paymentModel"]:checked'),
                valorKm: document.getElementById('valorKm'),
                valorPedido: document.getElementById('valorPedido'),
                valorDiaria: document.getElementById('valorDiaria'),
                custoFixo: document.getElementById('custoFixo'),
                custoVariavelPedido: document.getElementById('custoVariavelPedido'),
                receitaMediaPedido: document.getElementById('receitaMediaPedido'),
            };

            const valueSpans = {
                diasUteisValue: document.getElementById('diasUteisValue'),
                entregadoresValue: document.getElementById('entregadoresValue'),
                pedidosPorEntregadorValue: document.getElementById('pedidosPorEntregadorValue'),
                kmPorEntregaValue: document.getElementById('kmPorEntregaValue'),
                valorKmValue: document.getElementById('valorKmValue'),
                valorPedidoValue: document.getElementById('valorPedidoValue'),
                valorDiariaValue: document.getElementById('valorDiariaValue'),
                custoFixoValue: document.getElementById('custoFixoValue'),
                custoVariavelPedidoValue: document.getElementById('custoVariavelPedidoValue'),
                receitaMediaPedidoValue: document.getElementById('receitaMediaPedidoValue'),
            };

            const outputs = {
                receitaTotal: document.getElementById('receitaTotal'),
                custoTotal: document.getElementById('custoTotal'),
                lucroPrejuizo: document.getElementById('lucroPrejuizo'),
                volumetriaTotal: document.getElementById('volumetriaTotal'),
                custoPorPedido: document.getElementById('custoPorPedido'),
                breakEven: document.getElementById('breakEven'),
            };

            const formatCurrency = (value) => {
                if (isNaN(value) || !isFinite(value)) return 'R$ 0,00';
                return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            };

            const formatNumber = (value) => {
                 if (isNaN(value) || !isFinite(value)) return 'N/A';
                 return Math.ceil(value).toLocaleString('pt-BR');
            }

            const ctx = document.getElementById('profitabilityChart').getContext('2d');
            const profitabilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Receita Total',
                            data: [],
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(22, 163, 74, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                        },
                        {
                            label: 'Custo Total',
                            data: [],
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                        },
                        {
                            label: 'Lucro/Prejuízo',
                            data: [],
                            borderColor: '#ca8a04',
                            backgroundColor: 'rgba(202, 138, 4, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value, index, values) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                           ticks: {
                                maxRotation: 0,
                                minRotation: 0
                           }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            function calculateAndRender() {
                const vals = {};
                for (const key in inputs) {
                    if (key === 'paymentModel') {
                         vals[key] = document.querySelector('input[name="paymentModel"]:checked').value;
                    } else {
                        vals[key] = parseFloat(inputs[key].value);
                    }
                }

                const volumetriaTotal = vals.entregadores * vals.pedidosPorEntregador * vals.diasUteis;
                const receitaTotal = volumetriaTotal * vals.receitaMediaPedido;
                
                let custoMotoboy = 0;
                if (vals.paymentModel === 'km') {
                    custoMotoboy = volumetriaTotal * vals.kmPorEntrega * vals.valorKm;
                } else if (vals.paymentModel === 'pedido') {
                    custoMotoboy = volumetriaTotal * vals.valorPedido;
                } else if (vals.paymentModel === 'diaria') {
                    custoMotoboy = vals.entregadores * vals.diasUteis * vals.valorDiaria;
                }

                const custoVariavelTotal = volumetriaTotal * vals.custoVariavelPedido;
                const custoTotal = vals.custoFixo + custoVariavelTotal + custoMotoboy;
                const lucroPrejuizo = receitaTotal - custoTotal;
                const custoPorPedido = volumetriaTotal > 0 ? custoTotal / volumetriaTotal : 0;
                
                const receitaPorPedido = vals.receitaMediaPedido;
                let custoVariavelUnitarioTotal = vals.custoVariavelPedido;
                if (vals.paymentModel === 'km') {
                     custoVariavelUnitarioTotal += vals.kmPorEntrega * vals.valorKm;
                } else if (vals.paymentModel === 'pedido') {
                    custoVariavelUnitarioTotal += vals.valorPedido;
                } 
                
                const margemContribuicao = receitaPorPedido - custoVariavelUnitarioTotal;
                let breakEven = 0;
                if (margemContribuicao > 0) {
                     breakEven = vals.custoFixo / margemContribuicao;
                } else if (vals.paymentModel === 'diaria') {
                     const receitaDiariaEntregador = vals.pedidosPorEntregador * vals.receitaMediaPedido;
                     const custoVarDiarioEntregador = vals.pedidosPorEntregador * vals.custoVariavelPedido + vals.valorDiaria;
                     const margemDiariaEntregador = receitaDiariaEntregador - custoVarDiarioEntregador;
                     if(margemDiariaEntregador > 0) {
                        const entregadoresNecessarios = vals.custoFixo / (margemDiariaEntregador * vals.diasUteis);
                        breakEven = entregadoresNecessarios * vals.pedidosPorEntregador * vals.diasUteis;
                     } else {
                        breakEven = Infinity;
                     }
                } else {
                    breakEven = Infinity;
                }
               
                outputs.receitaTotal.textContent = formatCurrency(receitaTotal);
                outputs.custoTotal.textContent = formatCurrency(custoTotal);
                outputs.lucroPrejuizo.textContent = formatCurrency(lucroPrejuizo);
                outputs.lucroPrejuizo.classList.toggle('text-green-600', lucroPrejuizo >= 0);
                outputs.lucroPrejuizo.classList.toggle('text-red-600', lucroPrejuizo < 0);
                outputs.volumetriaTotal.textContent = formatNumber(volumetriaTotal);
                outputs.custoPorPedido.textContent = formatCurrency(custoPorPedido);
                outputs.breakEven.textContent = formatNumber(breakEven);

                updateChart(volumetriaTotal, receitaPorPedido, vals.custoFixo, custoVariavelUnitarioTotal, vals);
            }
            
            function updateChart(currentVolume, receitaUnitaria, custoFixo, custoVariavelUnitario, currentVals) {
                const labels = [];
                const receitaData = [];
                const custoData = [];
                const lucroData = [];

                const maxVolume = Math.max(currentVolume * 2, 100);
                const step = Math.ceil(maxVolume / 10);

                for (let vol = 0; vol <= maxVolume; vol += step) {
                    labels.push(vol);
                    const receita = vol * receitaUnitaria;
                    let custo = custoFixo;

                    if (currentVals.paymentModel === 'diaria') {
                         const entregadoresNecessarios = Math.ceil(vol / (currentVals.pedidosPorEntregador * currentVals.diasUteis));
                         const custoMotoboysDiaria = entregadoresNecessarios * currentVals.diasUteis * currentVals.valorDiaria;
                         custo += vol * currentVals.custoVariavelPedido + custoMotoboysDiaria;
                    } else {
                         custo += vol * custoVariavelUnitario;
                    }

                    receitaData.push(receita);
                    custoData.push(custo);
                    lucroData.push(receita - custo);
                }

                profitabilityChart.data.labels = labels;
                profitabilityChart.data.datasets[0].data = receitaData;
                profitabilityChart.data.datasets[1].data = custoData;
                profitabilityChart.data.datasets[2].data = lucroData;
                profitabilityChart.update();
            }


            const allInputs = document.querySelectorAll('#input-form input');
            allInputs.forEach(input => {
                input.addEventListener('input', () => {
                     if (input.type === 'range') {
                        const valueSpan = document.getElementById(input.id + 'Value');
                        if (valueSpan) {
                            if (input.step < 1) {
                                valueSpan.textContent = parseFloat(input.value).toFixed(2);
                            } else {
                                valueSpan.textContent = input.value;
                            }
                        }
                    }
                    calculateAndRender();
                });
            });

            calculateAndRender();
        });
    </script>
</body>
</html>

